<!-- app/views/diets/index.html.erb -->
<div class="row mb-4">
  <div class="col-md-6">
    <h1>Dietas de <%= @client.name %></h1>
    <p class="text-muted">Total de Calorias do Dia: <strong><%= @daily_total_calories.round(1) %> kcal</strong></p>
  </div>
  <div class="col-md-6 text-end">
    <!-- BOTÃƒO PARA GERAR PDF -->
   
    <%= link_to "Nova RefeiÃ§Ã£o", new_client_diet_path(@client), class: "btn btn-primary me-2" %>
    <%= link_to "Voltar ao Cliente", @client, class: "btn btn-secondary" %>
  </div>
</div>

<!-- CARDS DAS DIETAS -->
<% if @diets.any? %>
  <div class="row">
    <% @diets.each do |diet| %>
      <div class="col-lg-4 col-md-6 mb-4">
        <div class="card h-100">
          <div class="card-header bg-primary text-white">
            <div class="d-flex justify-content-between align-items-center">
              <h5 class="mb-0"><%= diet.name %></h5></span>
            </div>
          </div>
          <div class="card-body">
            <!-- ESTATÃSTICAS PRINCIPAIS -->
            <div class="row text-center mb-3">
              <div class="col-6">
                <h4 class="text-warning"><%= diet.total_calories.round(1) %></h4>
                <small>kcal</small>
              </div>
              <div class="col-6">
                <h6><%= diet.diet_foods.count %></h6>
                <small>alimentos</small>
                <!-- LISTA COMPACTA DOS ALIMENTOS -->
                <div class="mt-1">
                  <% if diet.diet_foods.any? %>
                    <small class="text-muted d-block" style="font-size: 0.75rem;">
                      <%= diet.diet_foods.includes(:food).limit(2).map { |df| "#{df.quantity_grams.to_i}g #{df.food.name.split(',').first}" }.join(", ") %>
                      <% if diet.diet_foods.count > 2 %>
                        <span class="text-primary">... +<%= diet.diet_foods.count - 2 %></span>
                      <% end %>
                    </small>
                  <% else %>
                    <small class="text-muted fst-italic">vazio</small>
                  <% end %>
                </div>
              </div>
            </div>
            
            <!-- MACRONUTRIENTES -->
            <div class="row text-center mb-2">
              <div class="col-4">
                <span class="text-primary"><%= diet.total_protein.round(1) %>g</span><br>
                <small>ProteÃ­na</small>
              </div>
              <div class="col-4">
                <span class="text-info"><%= diet.total_carbs.round(1) %>g</span><br>
                <small>Carbs</small>
              </div>
              <div class="col-4">
                <span class="text-danger"><%= diet.total_fat.round(1) %>g</span><br>
                <small>Gordura</small>
              </div>
            </div>
            
            <!-- OBSERVAÃ‡Ã•ES (SE HOUVER) -->
            <% if diet.notes.present? %>
              <p class="mb-0"><small class="text-muted"><%= diet.notes.truncate(40) %></small></p>
            <% end %>
          </div>
          <div class="card-footer">
            <div class="btn-group w-100">
              <%= link_to "Editar", client_diet_path(@client, diet), class: "btn btn-warning btn-sm" %>
              <%= link_to "Ã—", client_diet_path(@client, diet), method: :delete, 
                          confirm: "Excluir #{diet.name}?", class: "btn btn-danger btn-sm" %>
            </div>
          </div>
        </div>
      </div>
    <% end %>
  </div>

  <!-- RESUMO TOTAL DO DIA -->
  <div class="row mt-4">
    <div class="col-12">
      <div class="card">
        <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
          <h5 class="mb-0">ðŸ“Š Resumo Total do Dia</h5>
          <!-- BOTÃƒO PDF NO RESUMO TAMBÃ‰M -->
          <%= link_to "ðŸ“„ PDF Completo", diet_pdf_client_path(@client, format: :pdf), 
                      class: "btn btn-light btn-sm", target: "_blank" %>
        </div>
        <div class="card-body">
          <div class="row text-center">
            <div class="col-md-3">
              <div class="bg-warning text-white p-3 rounded">
                <h3><%= @daily_total_calories.round(1) %></h3>
                <p class="mb-0">Total Kcal</p>
              </div>
            </div>
            <div class="col-md-3">
              <div class="bg-primary text-white p-3 rounded">
                <h3><%= @diets.sum(&:total_protein).round(1) %>g</h3>
                <p class="mb-0">ProteÃ­nas</p>
                <small>
                  <%= ((@diets.sum(&:total_protein) * 4) / @daily_total_calories * 100).round(1) %>% das kcal
                </small>
              </div>
            </div>
            <div class="col-md-3">
              <div class="bg-info text-white p-3 rounded">
                <h3><%= @diets.sum(&:total_carbs).round(1) %>g</h3>
                <p class="mb-0">Carboidratos</p>
                <small>
                  <%= ((@diets.sum(&:total_carbs) * 4) / @daily_total_calories * 100).round(1) %>% das kcal
                </small>
              </div>
            </div>
            <div class="col-md-3">
              <div class="bg-danger text-white p-3 rounded">
                <h3><%= @diets.sum(&:total_fat).round(1) %>g</h3>
                <p class="mb-0">Gorduras</p>
                <small>
                  <%= ((@diets.sum(&:total_fat) * 9) / @daily_total_calories * 100).round(1) %>% das kcal
                </small>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

<% else %>
  <div class="text-center py-5">
    <h4 class="text-muted">Nenhuma dieta criada ainda</h4>
    <p class="text-muted">Comece criando a primeira refeiÃ§Ã£o para <%= @client.name %>!</p>
    <%= link_to "Criar Primeira Dieta", new_client_diet_path(@client), class: "btn btn-success btn-lg" %>
  </div>
<% end %>

<!-- ESTILO PARA BOTÃ•ES PDF -->
<style>
.btn-success {
  background: linear-gradient(135deg, #28a745, #20c997);
  border: none;
  font-weight: 600;
}

.btn-success:hover {
  background: linear-gradient(135deg, #20c997, #28a745);
  transform: translateY(-1px);
}
</style>