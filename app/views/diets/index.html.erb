<!-- T√≠tulo e bot√µes -->
<div class="row mb-4 align-items-center">
  <div class="col-md-6">
    <h1 class="fw-bold mb-0">Dieta de <%= @client.name %></h1>
  </div>
  <div class="col-md-6 text-end">
    <!-- Dropdown simples -->
      <div class="dropdown">
        <button class="btn btn-danger me-2 dropdown-toggle" data-bs-toggle="dropdown">
          <i class="bi bi-file-pdf"></i> Baixar PDF
        </button>
        <ul class="dropdown-menu">
          <li>
            <%= link_to "‚òÄÔ∏è Tema Claro", 
                diet_pdf_client_path(@client, format: :pdf, theme: 'light'), 
                class: "dropdown-item", target: "_blank" %>
          </li>
          <li>
            <%= link_to "üåô Tema Escuro", 
                diet_pdf_client_path(@client, format: :pdf, theme: 'dark'), 
                class: "dropdown-item", target: "_blank" %>
          </li>
        </ul>
         <%= link_to "Nova Refei√ß√£o", new_client_diet_path(@client), class: "btn btn-primary me-2" %>
    <%= link_to "Voltar ao Cliente", @client, class: "btn btn-outline-secondary" %>
      </div>
   
  </div>
</div>

<% if @diets.any? %>
  <div class="row">
    <% @diets.each do |diet| %>
      <div class="col-lg-4 col-md-6 mb-4">
        <div class="card shadow-sm border-1 h-100">
          <!-- Header -->
          <div class="card-header bg-white border-0">
            <h5 class="fw-semibold text-dark mb-0"><%= diet.name %></h5>
          </div>

          <!-- Body -->
          <div class="card-body">
            <div class="text-center mb-3">
              <h3 class="fw-bold text-primary"><%= diet.total_calories.round(1) %> kcal</h3>
            </div>

            <% if diet.notes.present? %>
              <div class="alert alert-light border text-muted small mb-3">
                <%= diet.notes.truncate(80) %>
              </div>
            <% end %>

            <% if diet.diet_foods.any? %>
              <ul class="list-unstyled small text-muted">
                <% diet.diet_foods.limit(5).each do |df| %>
                  <li class="mb-1">
                    <span class="badge bg-light text-dark"><%= df.quantity_grams.to_i %>g</span>
                    <%= df.food.name.split(',').first %>
                  </li>
                <% end %>
              </ul>
            <% else %>
              <p class="fst-italic text-muted small">Nenhum alimento adicionado</p>
            <% end %>

            <!-- Macros -->
            <div class="row text-center mt-3 pt-3 border-top">
              <div class="col">
                <span class="fw-bold text-primary"><%= diet.total_protein.round(1) %>g</span>
                <small class="d-block text-muted">Prote√≠na</small>
              </div>
              <div class="col">
                <span class="fw-bold text-success"><%= diet.total_carbs.round(1) %>g</span>
                <small class="d-block text-muted">Carboidratos</small>
              </div>
              <div class="col">
                <span class="fw-bold text-danger"><%= diet.total_fat.round(1) %>g</span>
                <small class="d-block text-muted">Gordura</small>
              </div>
            </div>
          </div>

          <!-- Footer -->
          <div class="card-footer bg-white border-0">
            <div class="d-flex gap-2">
              <%= link_to "Editar", client_diet_path(@client, diet), 
                  class: "btn btn-outline-primary btn-sm flex-fill" %>
              <%= button_to client_diet_path(@client, diet),
                    method: :delete,
                    data: { turbo_confirm: "Excluir #{diet.name}?" },
                    class: "btn btn-outline-danger btn-sm flex-fill" do %>
                Excluir
              <% end %>
            </div>
          </div>
        </div>
      </div>
    <% end %>
  </div>

  <!-- Resumo Total -->
  <div class="row mt-5 g-3">
    <div class="col-md-3 col-6">
      <div class="card border-1 shadow-sm text-center p-3">
        <h3 class="fw-bold text-warning"><%= @daily_total_calories.round(1) %></h3>
        <p class="mb-0 text-muted">Total Kcal</p>
      </div>
    </div>
    <div class="col-md-3 col-6">
      <div class="card border-1 shadow-sm text-center p-3">
        <h3 class="fw-bold text-primary"><%= @diets.sum(&:total_protein).round(1) %>g</h3>
        <p class="mb-0 text-muted">Prote√≠nas</p>
      </div>
    </div>
    <div class="col-md-3 col-6">
      <div class="card border-1 shadow-sm text-center p-3">
        <h3 class="fw-bold text-success"><%= @diets.sum(&:total_carbs).round(1) %>g</h3>
        <p class="mb-0 text-muted">Carboidratos</p>
      </div>
    </div>
    <div class="col-md-3 col-6">
      <div class="card border-1 shadow-sm text-center p-3">
        <h3 class="fw-bold text-danger"><%= @diets.sum(&:total_fat).round(1) %>g</h3>
        <p class="mb-0 text-muted">Gorduras</p>
      </div>
    </div>
  </div>
 </div>
<% else %>
<div class="text-center py-5">
    <h4 class="text-muted">Comece criando a primeira refei√ß√£o para <%= @client.name %>!</h4>
    <%= link_to "Nova Refei√ß√£o", new_client_diet_path(@client), class: "btn btn-success btn-lg" %>
  </div>
<% end %>


<script>
function toggleNotes(dietId) {
  const shortNotes = document.getElementById(`notes-short-${dietId}`);
  const fullNotes = document.getElementById(`notes-full-${dietId}`);
  
  if (shortNotes.style.display === 'none') {
    shortNotes.style.display = 'inline';
    fullNotes.style.display = 'none';
  } else {
    shortNotes.style.display = 'none';
    fullNotes.style.display = 'inline';
  }
}
</script>