<div class="row mb-4">
  <div class="col-md-8">
    <h1>Dietas de <%= @client.name %></h1>
    <p class="text-muted">Total de Calorias do Dia: <strong><%= @daily_total_calories.round(1) %> kcal</strong></p>
  </div>
  <div class="col-md-4 text-end">
    <%= link_to "Nova Dieta", new_client_diet_path(@client), class: "btn btn-success" %>
    <%= link_to "Voltar ao Cliente", @client, class: "btn btn-secondary" %>
  </div>
</div>

<% if @diets.any? %>
  <div class="row">
    <% @diets.each do |diet| %>
      <div class="col-lg-4 col-md-6 mb-4">
        <div class="card h-100">
          <div class="card-header bg-primary text-white">
            <div class="d-flex justify-content-between align-items-center">
              <h5 class="mb-0"><%= diet.name %></h5>
              <span class="badge bg-light text-dark"><%= diet.meal_type.capitalize %></span>
            </div>
          </div>
          <div class="card-body">
            <div class="row text-center">
              <div class="col-6">
                <h4 class="text-warning"><%= diet.total_calories.round(1) %></h4>
                <small>kcal</small>
              </div>
              <div class="col-6">
                <small>Alimentos</small>
                <% if diet.diet_foods.any? %>
                  <div class="small text-muted mt-1">
                    <%= diet.diet_foods.includes(:food).limit(4).map { |df| df.food.name.split(',').first }.join(", ") %>
                    
                  </div>
                <% end %>
              </div>
            </div>
            
            <div class="row mt-2 text-center">
              <div class="col-4">
                <span class="text-primary"><%= diet.total_protein.round(1) %>g</span><br>
                <small>Proteína</small>
              </div>
              <div class="col-4">
                <span class="text-info"><%= diet.total_carbs.round(1) %>g</span><br>
                <small>Carbs</small>
              </div>
              <div class="col-4">
                <span class="text-danger"><%= diet.total_fat.round(1) %>g</span><br>
                <small>Gordura</small>
              </div>
            </div>
            
            <% if diet.notes.present? %>
              <p class="mt-3 mb-0"><small class="text-muted"><%= diet.notes %></small></p>
            <% end %>
          </div>
          <div class="card-footer">
            <div class="btn-group w-100">
              <%= link_to "Montar Dieta", client_diet_path(@client, diet), class: "btn btn-primary btn-sm" %>
              <%= link_to "Editar", edit_client_diet_path(@client, diet), class: "btn btn-warning btn-sm" %>
              <%= link_to "Excluir", client_diet_path(@client, diet), method: :delete, 
                          confirm: "Tem certeza?", class: "btn btn-danger btn-sm" %>
            </div>
          </div>
        </div>
      </div>
    <% end %>
  </div>
<% else %>
  <div class="text-center py-5">
    <h4 class="text-muted">Nenhuma dieta criada ainda</h4>
    <p class="text-muted">Comece criando a primeira refeição para <%= @client.name %>!</p>
    <%= link_to "Criar Primeira Dieta", new_client_diet_path(@client), class: "btn btn-success btn-lg" %>
  </div>
<% end %>
